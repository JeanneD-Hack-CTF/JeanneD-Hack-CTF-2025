#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

unsigned char banner[] = {
  0x20, 0x20, 0x20, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x5f, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x5f, 0x5f, 0x5f,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x5f, 0x5f, 0x20, 0x20, 0x20, 0x5f,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x0a, 0x20, 0x20, 0x2f, 0x20, 0x5f, 0x5f, 0x5f, 0x5f, 0x7c, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x28, 0x5f, 0x29, 0x20, 0x20, 0x20, 0x20, 0x20, 0x7c, 0x20, 0x5c,
  0x20, 0x5c, 0x20, 0x20, 0x20, 0x20, 0x2f, 0x20, 0x2f, 0x20, 0x20, 0x7c,
  0x20, 0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x0a, 0x20, 0x7c, 0x20, 0x28, 0x5f, 0x5f, 0x5f, 0x20, 0x20, 0x5f,
  0x20, 0x5f, 0x5f, 0x20, 0x20, 0x20, 0x5f, 0x5f, 0x5f, 0x20, 0x20, 0x5f,
  0x5f, 0x5f, 0x20, 0x5f, 0x20, 0x20, 0x5f, 0x5f, 0x20, 0x5f, 0x7c, 0x20,
  0x7c, 0x5c, 0x20, 0x5c, 0x20, 0x20, 0x2f, 0x20, 0x2f, 0x5f, 0x20, 0x5f,
  0x7c, 0x20, 0x7c, 0x5f, 0x20, 0x20, 0x20, 0x5f, 0x20, 0x20, 0x5f, 0x5f,
  0x5f, 0x20, 0x0a, 0x20, 0x20, 0x5c, 0x5f, 0x5f, 0x5f, 0x20, 0x5c, 0x7c,
  0x20, 0x27, 0x5f, 0x20, 0x5c, 0x20, 0x2f, 0x20, 0x5f, 0x20, 0x5c, 0x2f,
  0x20, 0x5f, 0x5f, 0x7c, 0x20, 0x7c, 0x2f, 0x20, 0x5f, 0x60, 0x20, 0x7c,
  0x20, 0x7c, 0x20, 0x5c, 0x20, 0x5c, 0x2f, 0x20, 0x2f, 0x20, 0x5f, 0x60,
  0x20, 0x7c, 0x20, 0x7c, 0x20, 0x7c, 0x20, 0x7c, 0x20, 0x7c, 0x2f, 0x20,
  0x5f, 0x20, 0x5c, 0x0a, 0x20, 0x20, 0x5f, 0x5f, 0x5f, 0x5f, 0x29, 0x20,
  0x7c, 0x20, 0x7c, 0x5f, 0x29, 0x20, 0x7c, 0x20, 0x20, 0x5f, 0x5f, 0x2f,
  0x20, 0x28, 0x5f, 0x5f, 0x7c, 0x20, 0x7c, 0x20, 0x28, 0x5f, 0x7c, 0x20,
  0x7c, 0x20, 0x7c, 0x20, 0x20, 0x5c, 0x20, 0x20, 0x2f, 0x20, 0x28, 0x5f,
  0x7c, 0x20, 0x7c, 0x20, 0x7c, 0x20, 0x7c, 0x5f, 0x7c, 0x20, 0x7c, 0x20,
  0x20, 0x5f, 0x5f, 0x2f, 0x0a, 0x20, 0x7c, 0x5f, 0x5f, 0x5f, 0x5f, 0x5f,
  0x2f, 0x7c, 0x20, 0x2e, 0x5f, 0x5f, 0x2f, 0x20, 0x5c, 0x5f, 0x5f, 0x5f,
  0x7c, 0x5c, 0x5f, 0x5f, 0x5f, 0x7c, 0x5f, 0x7c, 0x5c, 0x5f, 0x5f, 0x2c,
  0x5f, 0x7c, 0x5f, 0x7c, 0x20, 0x20, 0x20, 0x5c, 0x2f, 0x20, 0x5c, 0x5f,
  0x5f, 0x2c, 0x5f, 0x7c, 0x5f, 0x7c, 0x5c, 0x5f, 0x5f, 0x2c, 0x5f, 0x7c,
  0x5c, 0x5f, 0x5f, 0x5f, 0x7c, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x7c, 0x20, 0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x0a, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x7c, 0x5f, 0x7c, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x0a, 0x00
};
unsigned int banner_len = 488;

// Use a structure as the compiler should not optimize the memory layout
struct frame {
	char buffer[128];
	unsigned long x;
};

void win(void) {
  char buffer[1024];
  puts("Here is your flag:\n");
  FILE *fp = fopen("flag.txt", "r");
  if (fp == NULL) {
    perror("fopen");
  }
  fgets(buffer, 1024, fp);
  fclose(fp);
  puts(buffer);
  fflush(stdout);
}

int main(int argc, char** argv) {
  printf("%s\n", banner);
  printf("Do you know how to find the special value?\n");

	struct frame f;
	memset(&f, 0, sizeof(f));

	printf("> ");
	fflush(stdout);

	read(STDIN_FILENO, &f.buffer[0], 132);

	printf("x = %lx\n", f.x);
	if (f.x == (unsigned long)0xdeadbeef) {
    win();
	}

	return EXIT_SUCCESS;
}

